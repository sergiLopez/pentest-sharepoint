# pentest-sharepoint

## Directorios importantes en SharePoint y sus funciones
| Directorio           | Función e Información                                                                                      |
|----------------------|------------------------------------------------------------------------------------------------------------|
| _layouts             | Contiene páginas de administración y configuración. Permite a los administradores gestionar configuraciones a nivel de sitio y colección de sitios. Ejemplo de uso: `http://sitio/_layouts/15/settings.aspx` |
| _vti_bin             | Contiene servicios web de SharePoint. Es fundamental para la integración y desarrollo de aplicaciones que interactúan con SharePoint. Ejemplo de uso: `http://sitio/_vti_bin/lists.asmx` |
| _app_bin             | Diseñada para alojar ensamblados de aplicaciones, aunque no debe usarse para ensamblados de WebPart. Uso: Ensamblados de aplicaciones específicas. |
| _vti_pvt             | Utilizado por las Extensiones FrontPage/SharePoint Designer. Contiene archivos de infraestructura necesarios para SharePoint Designer. Uso: Archivos de soporte para SharePoint Designer. |
| Bin                  | Almacena ensamblados compilados (.dll) que se refieren automáticamente en la aplicación. Uso: Controles, componentes y otros códigos personalizados. |
| App_Browsers         | Contiene definiciones de navegadores que ASP.NET utiliza para identificar navegadores y sus capacidades. Uso: Definiciones de compatibilidad de navegador. |
| App_GlobalResources  | Contiene recursos globales (.resx y .resources) accesibles programáticamente. Uso: Recursos globales y de alcance amplio. |
| Wpresources          | Contiene archivos de configuración para Web Parts. Uso: Configuración de Web Parts. |
| _catalogs            | Contiene varias galerías de catálogos, como la galería de Web Parts y la galería de plantillas de sitios. Uso: Gestión de componentes reutilizables y plantillas. |

## Recopilación Pasiva con Google Dorks

La recopilación pasiva es el primer paso y se puede realizar utilizando Google Dorks para identificar posibles páginas y directorios de SharePoint. Aquí hay algunos Google Dorks útiles:

1. **Identificar Listas de SharePoint**:
inurl:"/viewlsts.aspx?BaseType="
2. **Encontrar Páginas de Configuración y Administración**:
inurl:"/_layouts"
3. **Buscar Catálogos de SharePoint**:
inurl:"/_catalogs"
4. **Localizar Todo el Contenido del Sitio**:
"All site content" ext

## FUZZING

Vamos a utilizar el diccionario SecLists para descubrir contenido web en SharePoint. Primero, instalaremos SecLists con los siguientes comandos:
```bash
sudo apt update
sudo apt install seclists
```

En concreto, utilizaremos este diccionario:
**/usr/share/seclists/Discovery/Web-Content/CMS/sharepoint.txt**

### Directorios más importantes:

| Directorio                         | Explicación                                                                                           |
|------------------------------------|-------------------------------------------------------------------------------------------------------|
| /_layouts/viewlsts.aspx            | Página de administración y configuración de listas. Permite ver y gestionar todas las listas del sitio.|
| /shared documents/forms/allitems.aspx | Página que muestra todos los elementos dentro de la biblioteca de documentos compartidos.               |
| /SitePages/Forms/AllPages.aspx     | Página que muestra todas las páginas del sitio. Permite la gestión y visualización de todas las páginas creadas.|

### Otros directorios interesantes:

| Directorio                         | Explicación                                                                                           |
|------------------------------------|-------------------------------------------------------------------------------------------------------|
| /_layouts/15/settings.aspx         | Página de configuración del sitio, permite a los administradores cambiar ajustes importantes.         |
| /_layouts/15/user.aspx             | Página para la gestión de usuarios del sitio.                                                          |
| /_vti_bin/lists.asmx               | Servicio web de SharePoint para interactuar con las listas del sitio.                                 |
| /_layouts/15/viewallsitecontent.aspx | Página que permite ver todo el contenido del sitio.                                                  |
| /_catalogs/masterpage/Forms/AllItems.aspx | Página que muestra todos los elementos en la galería de páginas maestras.                          |
| /_layouts/15/mngsubwebs.aspx       | Página para gestionar las subwebs del sitio.                                                           |
| /_layouts/15/aclinv.aspx           | Página para invitar usuarios y gestionar permisos.                                                     |
| /_vti_bin/sites.asmx               | Servicio web de SharePoint para interactuar con los sitios.                                           |
| /_vti_bin/webs.asmx                | Servicio web de SharePoint para interactuar con las webs del sitio.                                   |
| /_layouts/15/sitemanager.aspx      | Página de administración del sitio para la gestión avanzada de contenidos y estructura.               |
| /pages/forms/editform.aspx         | Página que permite editar formularios dentro del sitio.                                               |

### Herramientas interesantes:

| Herramienta                                        | Descripción                                                                                                 |
|----------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
| [Sparty-2.0](https://github.com/MayankPandey01/Sparty-2.0)             | Herramienta para la enumeración y explotación de vulnerabilidades en SharePoint.                            |
| [SharePointURLBrute-v1.1](https://github.com/bhasbor/SharePointURLBrute-v1.1) | Herramienta para la enumeración de URL en SharePoint mediante fuerza bruta.                                 |

### Referencias interesantes:

- [A Security Review of SharePoint Site Pages](https://www.mdsec.co.uk/2020/03/a-security-review-of-sharepoint-site-pages/)
- [SharePoint Security Testing](https://www.archtis.com/sharepoint-security-testing/)
- [Hacking a SharePoint Website](https://blog.spartan-cybersec.com/2019/04/05/hacking-a-sharepoint-website/)
- [A Security Review of SharePoint Site Pages](https://www.mdsec.co.uk/2020/03/a-security-review-of-sharepoint-site-pages/)


